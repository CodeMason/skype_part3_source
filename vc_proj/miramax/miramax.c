// miramax.c : Defines the entry point for the console application.
//

/*
 *   Program to encode text using RSA public key.
 *
 *   *** For Demonstration use only *****
 *
 *   Copyright (c) 1988-1997 Shamus Software Ltd.
 */


#include <stdio.h>

#include "include/miracl.h"
#include <stdlib.h>
#include <string.h>


char calc_d[0x80];


char skype_pub[]=
"\xB8\x50\x6A\xEE\xD8\xED\x30\xFE\x1C\x0E\x67\x74\x87\x4B\x59\x20"
"\x6A\x77\x32\x90\x42\xA4\x9B\xE2\x40\x3D\xA4\x7D\x50\x05\x24\x41"
"\x06\x7F\x87\xBC\xD5\x7E\x65\x79\xB8\x3D\xF0\xBA\xDE\x2B\xEF\xF5"
"\xB5\xCD\x8D\x87\xE8\xB3\xED\xAC\x5F\x57\xFA\xBC\xCD\x49\x69\x59"
"\x74\xE2\xB5\xE5\xF0\x28\x7D\x6C\x19\xEC\xC3\x1B\x45\x04\xA9\xF8"
"\xBE\x25\xDA\x78\xFA\x4E\xF3\x45\xF9\x1D\x33\x9B\x73\xCC\x2D\x70"
"\xB3\x90\x4E\x11\xCA\x57\x0C\xE9\xB5\xDC\x4B\x08\xB3\xC4\x4B\x74"
"\xDC\x46\x35\x87\xEA\x63\x7E\xF4\x45\x6E\x61\x46\x2B\x72\x04\x2F"
"\xC2\xF4\xAD\x55\x10\xA9\x85\x0C\x06\xDC\x9A\x73\x74\x41\x2F\xCA"
"\xDD\xA9\x55\xBD\x98\x00\xF9\x75\x4C\xB3\xB8\xCC\x62\xD0\xE9\x8D"
"\x82\x82\x18\x09\x71\x05\x5B\x45\x7C\x06\xF3\x51\xE6\x11\x64\xFC"
"\x5A\x9D\xE9\xD8\x3D\x1D\x13\x78\x96\x40\x01\x38\x0B\x5B\x99\xEE"
"\x4C\x5C\x7D\x50\xAC\x24\x62\xA4\xB7\xEA\x34\xFD\x32\xD9\x0B\xD8"
"\xD4\xB4\x64\x10\x26\x36\x73\xF9\x00\xD1\xC6\x04\x70\x16\x5D\xF9"
"\xF3\xCB\x48\x01\x6A\xB8\xCA\x45\xCE\x68\x75\xA7\x1D\x97\x79\x15"
"\xCA\x82\x51\xB5\x02\x58\x74\x8D\xBC\x37\xFE\x33\x2E\xDC\x28\x55"
;


char remote_credentials[]=
"\x29\x68\x88\x87\xE8\x3A\x46\x77\xA5\x3B\xF1\x61"
"\x43\x7F\x08\x26\x72\x11\xAF\xFB\x9D\x17\x44\xC3\xB1\xFE\x2D\xBB"
"\x23\xE6\xFD\x3E\x6D\x41\x41\x11\x79\x25\x1B\xC3\x33\xB9\x6E\x25"
"\x27\x27\xF8\x02\xCF\x4E\xC9\xF3\x54\x0A\x3E\xAC\xE6\xC9\x64\x90"
"\xE8\x99\xA9\x17\xC5\x47\x3C\xCF\x7A\x9A\x27\x33\xEC\x32\x90\x45"
"\xA0\x26\x78\xA2\x9D\x33\x55\xE6\x93\x71\xE7\x0B\x0C\x02\x1D\x37"
"\x13\x99\x41\xF1\x6C\x7E\x64\xBE\x35\xFB\x5B\x2C\x68\x2C\xC1\xB0"
"\x4E\x83\x9B\xC0\xDA\xC6\x41\xC2\xA8\x34\xFD\x89\x7E\xB7\xE7\xB5"
"\x04\x60\xDC\xBF\x49\xCD\x9F\xCE\x28\x15\x4C\x5B\x20\xAF\xEC\xC6"
"\xDA\xC6\xEF\x96\xF8\x16\xB3\x3F\xB7\x13\x37\x29\x44\xFC\x79\xC1"
"\xFC\x1E\xAB\x00\x8B\xB2\xE0\x96\x09\x2A\xA0\xB3\x51\xE3\xB0\xA3"
"\xEA\x9A\x5D\x04\x1E\x08\x10\x6B\x9C\xAA\x89\xBD\x1B\xBF\xAC\xD6"
"\x58\x1D\x20\x14\x18\xD9\xB5\xDA\x43\x07\xF5\x25\x8F\x58\x06\x51"
"\xBC\xC3\x23\xA5\x87\x11\x27\xEF\xD0\xF3\x8B\xE3\x4F\xD8\x51\x9C"
"\x2A\xE3\x73\x99\x09\x4E\xB4\x8A\x2D\x6E\x28\x8A\x43\xDD\x56\x15"
"\x98\xBA\xCD\xD6\xB5\x1A\xBB\x4F\x03\x9D\x17\xAF\xA7\x02\x2C\x4B"
"\x4E\xF4\x6D\xDA"
;


/*
"\x05\xD9\x88\x1B\xFD\xFA\x6E"
"\x1F\x08\x2E\x37\x58\xBC\x0D\x20\x20\x4C\x01\x11\x63\xA2\x05\x8B"
"\x00\xE3\xA1\xC8\xBA\x56\xD0\xDE\x9E\x4F\x4F\xFC\x59\x7D\x15\x92"
"\x68\x46\x2F\xCA\xCD\x11\xEA\x12\xA5\x21\x33\x55\x53\xEE\xD6\x8E"
"\xA8\xB8\xA9\x29\xF2\x96\x25\x8A\x4F\x4C\xE3\x95\xB1\x16\x05\xBF"
"\xC3\xF0\x2C\x83\xB1\xB2\xE0\xB5\x21\x88\x4B\xB7\x64\xC6\x15\xA4"
"\x23\x47\x88\xAE\xC7\xDD\x0B\x43\x8E\x1B\x23\xEC\x83\xAD\x32\x21"
"\x8A\xF6\x5C\x50\xBE\xAB\x79\xE6\xC2\x3D\x64\xC2\x02\x3C\x0F\x76"
"\xC8\x58\x20\x96\x40\xDE\x2B\x51\xA2\x14\x3E\x94\x31\x60\x4F\xA8"
"\xD9\x02\x4B\x01\x9D\x4A\x0D\x09\x00\xE7\x4B\xC1\xF4\xAA\x0D\x1E"
"\x61\xFF\x92\x5E\xD0\x4E\xE2\x38\x58\x5A\x69\x58\xD3\x7C\x5B\xDF"
"\x17\x78\xDF\x29\x62\x7B\x04\x08\xBB\x97\xD9\xAE\x82\xA3\x48\x16"
"\x88\x24\xEE\x03\x40\xD9\xE6\x6D\x21\x53\x38\x54\x80\x34\x93\x77"
"\x8D\xBE\xA6\xC7\x5F\x6F\xC3\x6C\x61\x25\x9A\x0E\x0C\x34\x81\x16"
"\xCE\xF5\x55\x38\xFB\x67\xEC\xB4\x3B\xC8\xF6\x03\xC0\x41\x36\x0B"
"\x2A\x7B\x63\x3C\xFD\x17\x0D\xAF\xCB\xA9\x1A\xE7\x46\x9B\xC0\x91"
"\xEE\x7F\x2A\x60\x69\x04\xB0\x21\xD4"
;

*/

/*
"\x22\x2D\xA2\x0B\x07\x6F\x12\x87\xA8\x22\x41\x3E\xE7\x63\xBB\x5F"
"\x63\x0C\x79\x29\xB9\x44\x2A\xB9\xBC\x77\x18\xB0\x05\xD8\x37\xB1"
"\xAD\xA2\x06\x83\xF8\xFC\x07\xC0\xF1\x22\x91\x02\x28\x3B\x28\xEC"
"\x3B\xDE\xEE\x11\xC3\xEA\x05\xDF\xBA\x42\x79\x24\x8A\x47\xB3\x6A"
"\xB2\x86\xDA\x34\x77\x1B\x3A\xEF\x42\xB2\xCA\x87\x48\x55\x0E\x39"
"\xD2\xF7\x38\x46\x3C\x8E\x61\xAF\x35\x79\xF0\xE7\xBE\x62\x56\x9E"
"\x8A\x83\xFD\xDC\x75\x1E\xF8\x5B\x54\x2D\x89\xF1\x2F\xA7\x46\xCE"
"\x24\x86\x81\xF8\xB9\xB7\x15\xF8\xCD\x86\x42\xB7\x43\x67\x3D\xB5"
"\x83\xBE\x8E\x93\xCC\x81\xDE\x3A\x33\x99\x63\x5B\x33\x39\x06\x9C"
"\xE1\x7D\x16\x57\x08\x7C\x15\xE1\xE6\xAE\x51\xCE\x8A\x49\x11\xBF"
"\xF6\xE9\x7A\xAA\xE3\xC4\x7C\x6C\x83\x26\xEC\xBA\x43\xDD\x47\xF2"
"\x5C\xB3\xA6\xDC\x88\x9C\x66\xE8\x77\xCF\x1D\xAD\x3E\xFB\xB1\xF5"
"\x74\x3E\x2C\xC4\xEE\x7D\x18\xE4\x42\x13\x0C\x1B\x6E\x99\xA9\x28"
"\x84\x31\x7C\x07\xC0\xD2\xD9\xED\xA4\x3D\xF1\xA9\x25\x4F\xAA\xBB"
"\x32\x64\x5B\xE4\xDD\x54\x6F\xB3\x5C\xD0\x83\x2D\xBD\x45\x56\x0D"
"\xD7\xB1\x11\xD2\xF1\x23\x1D\x2C\x9F\xC1\xA6\x7E\x63\xFF\xC7\x0B"
;
*/



/*
//login1
"\x67\x2A\x4D\xA0\xBF\x64\x2F\x69\xB5\x9A\x6F\xDC\x75\x51\x7A\xAE"
"\xFC\x8A\x54\x46\x5A\xDE\x30\x71\xF6\x89\xCE\x94\xE8\x7A\xA5\x93"
"\xA6\x8B\xD3\x6F\xED\xE1\xE1\x04\x49\x23\xFE\xB8\x91\x20\xD5\xA0"
"\xDC\xA9\x91\x9A\x95\xBF\xE7\x11\x3A\x65\x71\xD1\x38\xDA\xEC\x40"
"\x00\x6D\xA0\x2D\xC0\xB5\x62\x28\x9E\x85\x78\x59\xF1\xE6\x13\xDE"
"\x7C\xFF\x32\xF4\xE6\x1B\xB2\x6B\xC1\xC6\xBE\x7A\x48\x09\x8E\x1D"
"\x3D\x54\x2C\x4C\x0E\x5A\xF1\xA9\xD1\x9C\x94\xDE\x4B\xA5\x59\x17"
"\x36\xCA\x76\x06\xF0\x5F\x18\x6F\xAC\x79\xA7\xCF\x54\xCB\x5C\xEE"
"\xB7\x41\xE9\x05\x9D\x0C\xAB\x85\x57\x03\x3A\x1B\xD1\x95\x58\x60"
"\x58\x0B\x5F\x07\xCA\x99\x3F\x8E\x3E\xA2\x5B\x71\x80\x3E\x49\x5D"
"\xD9\x81\xA8\x63\x08\x93\x36\x0C\xB1\x55\x81\xF2\xF5\xB0\x0B\xC0"
"\x92\x50\xB4\x2E\xBB\xF7\xAE\x8C\x60\x71\x65\xFD\xF6\x78\x5B\xB2"
"\x63\xEF\x53\xE4\xE3\x54\xA1\x87\x80\x2E\xB7\x99\x3D\x5A\xC9\xD7"
"\x5D\x49\xF6\xDE\xEA\x14\xB4\x07\xB6\x86\x8F\x93\x36\xD2\x1A\x25"
"\x32\xE5\x26\x90\x92\xF3\x1C\xF3\xAD\xA5\x39\x43\x09\x4A\xC3\x36"
"\x14\xBC\xF6\x1E\x99\x76\x00\x57\xBB\x3A\x75\x5E\x46\x86\x21\x6E"
;
*/

/*
"\x50\x6A\xF3\xC8\x9B\x67\xD0\x54\x4F\x36\xA0\x91"
"\x4A\xE8\x33\xF1\x72\xB6\xDF\x6A\xCB\x31\xAF\xCB\x07\x7E\x02\xA4"
"\x4A\xA8\xD1\x08\x32\x56\xEC\x76\x7F\x28\xC2\x4D\x71\x59\xB8\xB3"
"\x6E\xCF\xED\x9D\x38\x38\xF5\xFA\x89\xE3\xC4\x6D\xB5\xFE\x80\x97"
"\x7F\x67\x4E\xFE\xF6\xB9\x4D\xE2\x54\xD7\x90\xE1\x5E\xE9\xFF\x70"
"\xCF\xC2\x57\x2D\xF2\x74\xC2\xE3\x3C\x9A\x38\x14\xE2\xBB\xED\x51"
"\x26\xB5\xCA\x8F\xCA\x5E\x8D\x51\xCB\x01\x26\x01\x9E\xE2\xE1\x0C"
"\x7B\x79\x27\xC8\x62\xD2\x41\x6D\x39\xCE\x01\x68\x70\x56\x1D\xB7"
"\x72\x0C\x4F\x40\x82\x34\x38\x1F\x85\x72\x96\xA1\xA7\x50\x16\x64"
"\xD9\x23\x1F\x51\x35\xAE\x92\x5F\xF2\xF6\x87\x88\xA5\xD1\x1A\xF8"
"\xC0\x0A\xBF\x29\x56\xF9\x3D\x7C\xA2\x59\x7B\xD6\x4A\xA8\x55\x5B"
"\x6A\x7F\xB9\x14\xB8\x0E\xA8\x47\x3F\xB3\x92\x3B\x3E\x8B\x4C\x7B"
"\x74\xD6\xB6\xC0\x6E\xFF\xD6\xA4\x38\xAE\x0D\x7C\x75\xC6\x71\x65"
"\x62\x7A\xF7\x92\x98\x57\xB0\xBF\x52\x33\x59\xF8\x9F\xAF\x31\x80"
"\x78\x20\xF1\xDE\xDE\x07\xAD\x89\xBF\x7E\xBD\x9E\x74\xA3\x71\x07"
"\x70\x26\xE6\x77\x5D\xC8\x38\xCD\x9E\x6A\x10\x57\x02\xAF\xA0\x45"
"\xEC\xC9\xBB\xBD"
;
*/

/*
"\xA4\x10\x05\x82\x9D\xEC\x2E\x8A\x54\x1B\xE8\x32\x91"
"\x45\x4E\x18\xF2\x18\xAD\xD4\x6C\xF0\x79\x4F\x28\x83\xE6\x02\x7D"
"\xDD\x49\x60\x1E\xFA\xA5\x6B\x19\x8D\x37\xE1\x01\xA7\xC6\x3D\x58"
"\x49\x59\x6C\xBB\xC5\x80\x51\xB0\xF9\xE1\x79\x30\xB7\xC8\xA2\xDD"
"\xC7\x67\x01\x05\x48\x58\x60\xF8\x34\x01\x03\x80\xE3\xB1\xAA\x9E"
"\xCF\xA4\x92\x6E\xE1\x52\xCE\x0C\x6B\x09\x18\x49\x75\x07\x84\x81"
"\x5A\x99\xBB\x42\x70\xF3\x9B\xCE\x9C\xDF\x80\x2E\x28\x59\xC5\xFD"
"\x84\x01\xE0\x74\x28\x88\xD4\x9A\x2F\xBB\xA0\x70\x35\x72\xE6\x9F"
"\xF6\xE1\x59\xE2\xDA\x51\xEB\xFF\x26\x36\x6E\xC8\xBA\x28\x30\x8E"
"\x5F\x94\xC1\xBE\xFA\xB9\x60\xD3\xB8\xAD\xD8\x9C\xD4\x68\xB9\xD8"
"\xE4\xEE\x9D\xED\x44\x59\x66\x6D\xD3\xB1\xB8\x78\x26\x33\xB5\x2F"
"\xE8\x8A\x70\xD5\xCA\xE3\xA9\x6E\x8D\x3F\x32\xD0\xF0\x89\xB5\x11"
"\x03\x41\x15\xE6\xBC\x29\x12\xB1\x6B\xDE\x55\xBF\x9F\xA5\x83\x77"
"\x12\x1D\xDA\xB9\x73\x96\xE7\x6D\x7C\x80\x86\xC0\xE2\x3F\x80\x19"
"\xE6\x84\xF5\xA9\xB4\x3E\x11\xC4\x3B\xAA\xC3\x17\xF7\x16\xF8\x6E"
"\xCA\xCB\x95\x26\xD5\xDA\x9A\x3C\xC7\x12\xF0\x45\xF7\xEC\x6D\x4C"
"\xFD\x7A\x75"
;
*/




/*
"\xB2\x55\xE8\x19\x9D\x44\x7E\xE9"
"\xC6\xA9\x33\x25\x98\x1A\x52\xE5\x29\x49\xB9\xF5\x17\x60\x65\x71"
"\x69\x10\xCE\xF9\xAA\x2A\xFD\x90\x80\x4C\x92\xFE\x78\xC6\x96\xCB"
"\x63\x07\x03\xB3\xE5\x07\x14\xBB\x45\x62\x57\x60\x9F\x4E\x83\x8C"
"\x43\x87\xEA\x89\x1F\x6A\xC3\xC1\xF8\xFF\xB2\xC8\xE7\xB5\x4D\xF3"
"\xF9\x4F\x4E\x7E\x5C\xEF\x49\x50\xCC\x96\x83\x5E\xCD\x8D\x56\x17"
"\xF6\x8B\xC2\x9D\xF3\xAF\xFB\xD7\xA2\x2E\x91\x6E\xAE\x7A\xD6\xAF"
"\x5D\x18\x38\x52\x17\x43\x04\xD1\xEE\xBF\x43\x82\x34\xBA\x61\x0B"
"\xEC\x3A\xF4\x3D\x82\x3D\x3D\x5A\x56\x39\x6F\xEC\x88\xC5\x04\x91"
"\x5B\xA4\x8B\x28\x75\x3F\xFD\xB0\xBF\xCF\x0E\x5E\xD0\x95\x38\xB6"
"\x5A\x50\x30\xD2\xB4\x88\x81\xA8\x89\xB8\xB1\x3C\x6E\xE4\xF1\x0F"
"\x9C\x85\x2E\x64\xC8\xDD\x3F\x36\xDD\xA1\xA8\xC1\x94\x4E\x70\x3B"
"\x2F\x60\x51\x9A\xDC\xAE\x8D\x30\x8D\x43\x82\xE9\xE4\x4F\x53\x97"
"\x55\x4E\x5F\xDB\x6E\xF4\x75\xE3\x81\x4C\xBC\xD9\xE8\x68\x85\x06"
"\x56\x58\x52\xE1\x78\xFF\x2F\x26\x95\x8C\xDF\x21\xB1\x0B\x94\x1F"
"\x1C\xCA\x55\x69\x97\x0F\xE4\xBE\x7D\x9F\x73\xFD\x8B\x13\x29\xBD"
"\x56\x39\x68\xEB\x2E\x84\x0A\x2A"
;
*/

/*
"\x77\x9E\x0F\xA9\x19\xE7\xFD\x5A"
"\x43\x87\x44\x0A\x7B\x9D\x27\xE3\x3D\xCE\xF5\xEA\x3C\xEB\x5C\x2C"
"\x3A\xD2\x80\x84\x73\x59\x60\x91\x1F\x1E\xBF\xE5\x94\x4D\x9B\xA0"
"\xED\xB9\xE9\xB6\xB8\xFC\xA5\x20\x4A\xBA\xC5\x55\x82\xA4\x32\x0C"
"\x1E\xD8\x50\xDE\xFD\x53\x8B\x38\xB8\x9B\x94\xD5\x95\xFF\x75\x7B"
"\x9D\x7C\x32\x85\xDA\x85\x15\x4D\x4D\x5F\x0A\x45\xCC\xDC\x3B\x2F"
"\xA9\x69\x6A\xD5\xE8\x35\xC0\xAC\x69\xB7\x28\x93\xA1\x58\x95\xD5"
"\x34\x6F\xC9\x77\x93\x20\x3E\x0F\xEB\x02\x57\xD6\x26\x89\xB2\x4C"
"\x7C\x7B\x10\xD1\xD6\xFE\x38\x6E\x02\xA9\x94\xE0\xF0\xF6\x7B\x65"
"\xCF\x2F\x7F\x9B\x59\x5A\x3D\xCE\x11\x85\x0F\x46\xB3\x79\x52\x59"
"\x45\xF2\x68\x08\xF0\x67\x16\x7F\x8A\xE5\x08\x4A\x4A\xC0\xBD\xB2"
"\x7C\x0B\xF3\x90\x9D\xC1\x67\xB8\x68\xBA\x6C\x6B\x56\x69\xFD\xA6"
"\xAF\x93\x24\xAA\x5C\x83\x22\x87\x22\x8E\xD6\xFA\x24\xBA\x89\xAA"
"\xBA\x1E\x92\xE8\xDA\x00\x01\x9D\xC6\xEC\x4D\x51\x0E\xC2\xAD\x09"
"\xAB\x73\x1F\xFF\xFE\x4B\x74\xA4\x87\x19\xF7\x03\xA5\x2C\xBA\x64"
"\x8D\x28\x12\x7D\x41\xBF\x82\xEE\x3C\xF1\x6C\x20\x18\xBC\xA4\x23"
"\x5E\x99\x69\x0C\x13\x7D\x69\xB8"
;
*/


/*
"\x27\x54\x8d\xba\xe3\x31\x6d\xd2\xba\x3e\x34\x4d\xef"
"\xda\x51\x36\xee\x7b\x68\x31\x5d\x12\xed\x61\xd6\xb9\x82\x7f\xc3"
"\x42\xbd\x47\xd6\x3b\xdc\x28\xa9\x0d\x98\x79\xc7\x6e\x61\x30\x9b"
"\xb1\x3f\xda\x66\xce\xc0\x36\x4d\x52\x3d\xf4\x96\x08\xc1\x56\x9a"
"\xaf\xfe\x08\xd4\x52\x47\xbe\xf5\xc6\xa9\xa2\xd4\x38\x9e\x9e\x94"
"\x17\x1d\x5d\x7d\x76\x5b\x02\xdd\x9c\x6c\x9e\xdc\xb4\x18\x99\x4f"
"\x2b\xb7\xd4\xa0\xb6\x78\xa4\xf1\x9e\xee\x4b\x8e\x39\x97\x9e\x6b"
"\x54\xc0\x99\xfe\xf1\xe8\x40\xc5\x4c\x4f\xf2\x07\xd7\xb3\xd1\x15"
"\x63\x8b\x09\x03\xa3\xab\x86\x78\x50\xbb\xba\x00\xaf\xb2\x1f\xd8"
"\x8f\x62\xf6\x9b\x7e\x61\xae\xc1\x6f\x04\xff\xa3\xef\xba\x4e\xdc"
"\xf0\x1e\x22\x3c\x4a\x99\x8f\x6d\xdd\x6b\xd3\xe3\xd5\xda\xd8\x0c"
"\x5a\x13\x47\xaa\xae\x6f\x64\x0c\xe5\xf7\x92\x30\xf0\x0d\x18\x6c"
"\x82\x68\x5b\x66\x7a\x8f\x0d\x9a\xf4\xa0\x09\x64\x18\x52\x32\xaa"
"\x64\x69\x04\xd9\xd4\xa6\x0a\xca\x19\x54\xe8\x11\xeb\x84\x98\xf0"
"\x11\xbe\x9d\x27\x0c\xf4\x8f\xe5\x07\x95\x7e\x66\x31\x31\x1e\x39"
"\xe3\x5d\xc6\xf8\x93\xe0\xf3\xbc\x30\x06\x07\x6e\x59\x58\xe2\x4a"
"\x08\x26\xb6"
;
*/

/*
"\x62\x1C\x80\xD1\x9B\x96\xAA\x3B\xC5\xF5\xC7\x4C\x37"
"\xBF\xDC\x28\xCA\x8B\x68\x3D\x22\xFF\xD0\xAB\x23\x89\xB9\xB6\x94"
"\xB1\x0D\xF6\x79\x64\x61\xC9\xC9\xDC\x8B\xDF\x36\x37\x88\xC4\xDE"
"\x3B\x9F\xCB\xB1\x1A\x30\x0C\x86\xD2\xFC\x2C\xEE\x6A\x3C\x95\xC9"
"\xB5\xD1\xDA\x85\x76\x1A\x5B\x9B\xE6\xA3\x03\xEF\xA2\x96\x05\xCC"
"\x67\x86\x5C\x46\x06\xF1\x97\x2B\x2A\xC1\xB0\x29\xE3\xDE\x3A\x1E"
"\xC0\xE8\x7B\x96\x33\x64\xEC\xC6\xDD\x93\x82\x4E\x35\xE7\xCF\xA6"
"\x05\x5C\x08\xC0\xF7\x24\x45\x2A\x4F\x24\xFC\x25\xEC\x41\x7E\x94"
"\xFD\xF8\xBA\x59\x79\x7E\x70\x9F\xB7\x64\xE6\x95\xF9\x0F\xE1\x5E"
"\x31\x46\xE4\x19\xAB\xBE\x40\x7E\x34\x33\xBD\x7D\x0D\xBE\xE3\x94"
"\x32\xB0\x5A\xDF\x25\x4C\xCA\xDA\x1A\x4F\x8C\x90\x5E\x68\x24\x3E"
"\xBE\x36\x22\x87\x03\xDE\xB3\x5D\xBC\x04\x39\x5A\x90\x63\xC7\x92"
"\xD4\x2E\xEC\x2A\xD4\xB5\x6E\xC3\x9C\xF6\xB3\xA3\x0F\xA5\x72\xA9"
"\xC3\xE2\xCF\xCF\xA5\xBA\xCA\xF1\x14\xD0\x92\x69\x41\xE2\x09\xBB"
"\x64\x6E\x4B\xD8\xFC\x1E\x47\x61\x56\xD9\x56\x25\x63\x9D\x71\xDE"
"\xAF\xD3\xDD\x9F\x15\x07\x4E\x51\x4A\x43\xA3\x57\x25\x00\x34\x52"
"\x6C\xC1\x42"
;
*/




int show_memory(char *mem, int len, char *text){
	int zz;
	int i;
	int k;
	char b[16+1];
	int t;

	printf("%s\n",text);
	printf("Len: 0x%08X\n",len);

	zz=0;
	k=0;
	b[16]=0;
	for(i=0;i<len;i++){
		printf("%02X ",mem[i] & 0xff);
		t=mem[i] & 0xff;
		if ((t>=0x20) && (t<=0x7f)){
			memcpy(b+k,mem+i,1);
		}else{
			memcpy(b+k,"\x20",1);
		};
		zz++;
		k++;
		if (zz == 16) { 
			zz=0;
			k=0;
            printf(" ; %s",b);
			printf("\n ");

		};
	};
	printf("\n");

	return 0;
};

void strip(char *name)
{ /* strip off filename extension */
    int i;
    for (i=0;name[i]!='\0';i++)
    {
        if (name[i]!='.') continue;
        name[i]='\0';
        break;
    }
}



////////////////////// miracl start ///////////////////////


miracl *mip;

int rsa_unsign_cred(char *buf, int len, char *outbuf)
{  

    big e,m,kn;
	
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kn=mirvar(0);

    bytes_to_big(0x100,buf,m);
	bytes_to_big(0x100,skype_pub,kn);

	power(m,65537,kn,e);
	
	big_to_bytes (0x100, e, outbuf, TRUE);

    return 0;
}




int rsa_unsign()
{  

    big e,m,kn;

	char result[0x100];


	char xoteg_pub[]=
"\xBE\x60\x36\x97\xFC\xB6\xC9\x62\xD6\xC6\x02"
"\x9F\x2E\xCC\x2B\x61\x4C\x51\x3A\xB4\x71\x80\xE0\x88\x39\x92\xEC"
"\x12\x5E\xC9\x96\x0A\xD2\x0F\x0E\xF1\xC5\x8F\xD6\x2F\xFE\x1B\xF7"
"\xF9\x66\x24\xE7\x68\xDA\x61\xD6\x60\x47\x49\x30\x23\x0B\x0D\x98"
"\xEE\x26\xB4\x25\x39\xFB\x8F\x90\x9F\x08\xAF\x85\x0A\x46\x76\x07"
"\x9B\x34\x98\x1B\xF4\x8C\x54\xA5\x61\x1C\xDD\x09\x9E\xDA\x27\x6E"
"\x74\x77\xA9\xD7\x76\x46\xD6\xCA\x7D\x78\x8E\xC0\xA2\x6E\xFC\x46"
"\x6F\x64\xA8\x57\x0A\xD9\xB9\x9F\x78\x2E\xC0\x2F\x59\x7B\xDB\x7A"
"\x8E\xFE\xD4\xA9\x5D"
;
/*
"\xDB\x1D\x1B\x25\xCC"
"\x3F\x33\x96\x10\xFA\xC2\x16\x7C\x4E\x41\x01\xD3\xD7\x07\x17\x87"
"\xF3\x09\x24\x02\xC4\x43\xF1\xD2\xD2\x42\x4A\xC0\xAF\xD9\x9C\xF8"
"\x6D\x94\xE7\x7D\x83\x14\x0E\x2F\xCE\x51\xD1\xA6\xE1\xF1\xCF\x52"
"\x7F\xF4\x74\x36\x50\x98\x66\x5A\x52\xE3\x1D\x25\x3C\xB2\x2F\x95"
"\xBA\xDA\xE1\x02\x4A\xB2\x50\xF7\x56\x3C\xCE\xE3\xF9\x3A\x1B\x95"
"\x6B\xB3\x40\xDD\x6F\x22\x95\xD1\x53\xCC\xAC\xB7\xBA\x7B\x21\x60"
"\xE8\x2B\xDE\x8F\x19\x1B\x0D\x5F\x72\xC8\xF6\x92\x77\x87\x51\x39"
"\x26\xC3\x47\xF8\x43\xA2\x16\x06\xEB\x1C\xC9"
;
*/

	char crypto_text[]=
"\x57\x29\x66\x69\x0E\xA8\xEA\x19\xC1\x39\x51\xEE\x67\x33\xD9\x18"
"\xE3\x9B\x89\x35\x46\x24\x2A\x03\xC6\x8D\x97\x20\xD6\xA1\x99\x84"
"\x69\xAE\x12\x15\x83\xAA\x00\x26\x58\x42\x78\x4A\xEB\x51\x22\x1D"
"\x1A\xFD\x55\x30\x2B\x8A\xB2\x46\x6D\x1B\x25\x75\x7A\xA7\x1E\x11"
"\xCE\x24\xE8\x1F\x03\x09\x62\xB0\xF2\x61\x42\x6A\x5E\x59\x57\x06"
"\x54\xC2\x3B\x69\x9F\x63\xCE\x23\xF2\x49\x69\x2F\x42\x37\xD8\xFD"
"\xFF\x03\x3B\x25\x8C\x23\x12\xE2\xCE\xC8\x9F\x39\x51\x51\xFF\xF6"
"\xBB\xD2\x21\x8B\x93\x44\xB2\xE1\xE9\xD5\x3A\xEE\x76\x07\x71\x5C"
;


/*
"\x9A\x15\x8F\x50\x82\x6A\x04\x1C"
"\xDF\xBA\xED\x52\x16\xBE\x5C\xDC\x2B\x85\xCD\xC1\xF9\x57\xB5\xAE"
"\x9C\x3B\x4C\x17\x77\xAF\x8F\x1B\x1E\xEE\xAB\x62\x5B\xDE\xA0\x53"
"\x25\x2E\x65\x0F\xAB\xD2\xB8\x73\x3B\x0F\xC0\xD5\x16\xE7\x3C\x04"
"\x23\x08\xA7\x32\x0B\xB8\x3B\x4E\xA8\x37\x89\xAB\xBB\xBF\x06\xDB"
"\xF9\xBB\xE7\xE3\x11\x63\x4F\xE3\x73\x54\x53\xE6\x5C\x76\x22\x48"
"\x16\x22\x43\xFC\xD0\xD3\x28\xBD\x20\x38\x80\x68\x1B\x35\xDB\x85"
"\xB1\xBC\xBD\xA8\x8A\x4C\xF6\xE4\x74\xC2\xC3\xD7\x7A\xEB\x53\x1D"
"\xBA\xC6\xFA\xDE\x44\x36\xAE\x12"
;
*/
	
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kn=mirvar(0);


    bytes_to_big(0x80,crypto_text,m);
	bytes_to_big(0x80,xoteg_pub,kn);


	power(m,65537,kn,e);

	big_to_bytes (0x80, e, result, TRUE);

	show_memory(result,0x80,"data unsign:");



	printf("message ends\n");

    return 0;
}





int rsa_sign()
{  

    big e,m,kd,kn;

	char result[0x80];


	char xoteg_pub[]="\xD0\x40\xD6\xCB\x9A"
"\xAA\x01\xB3\xDA\x02\x63\x8A\x1F\x37\x34\x44\x7C\x68\x2F\x6B\xC1"
"\xB2\xA0\xA3\x44\x22\x04\xB6\xF3\x6C\x7E\xCB\x13\x27\x24\xC7\x21"
"\x49\xD0\x3A\x36\x26\xE3\x85\x61\x7B\x74\x1C\xD8\xFB\xC0\xF1\x67"
"\x73\x0A\x36\x52\x6E\xCF\x85\xA2\x07\x1E\x03\x71\x1A\xB1\x5A\x45"
"\x76\x83\x19\x63\xF8\x74\xE3\x95\xFF\x3F\xB8\x24\x6D\xD2\xFD\xBC"
"\xC0\xD4\x7C\x72\xCB\x1A\x20\x42\xEC\x1B\xAE\x83\x12\xA3\x5C\x45"
"\x3E\x42\x12\xCE\xB4\xAA\xD7\xA0\xB8\xFC\x32\xAC\x32\xC3\xB3\xFC"
"\xA0\x15\x96\xEB\xC7\x44\x90\x7D\xE8\xF3\x65"
;

	char xoteg_sec[]=
"\x4B\x80\x36\x5F\x7A\xA3\x48\x1A\xBC\x5F\x41\x57\x42\x19\xF1\x89"
"\x22\xD1\x62\xDF\xDE\x49\xB4\x93\x7C\x90\x18\xC5\x7B\x5B\x4A\x5C"
"\xB5\x84\xEB\x80\x86\x41\x0C\x8D\x0E\x34\xEB\x27\xE0\x3F\xB1\xC9"
"\x03\xA1\xC2\x41\xC3\x0F\xA2\x14\x2F\xAE\x9C\xEE\x05\xE0\x2E\xB0"
"\xC9\x43\x27\x78\x73\x28\xE2\xFA\xCD\x34\x31\xC1\x55\xCC\x3F\x16"
"\xBA\x9A\xF8\x18\x2F\x2C\xCC\xDF\x76\xFA\x89\x4A\x63\xE1\x48\x2B"
"\x0A\x2F\xDA\x5D\x7A\x50\xE6\x35\x15\xFE\xDA\xD5\xA8\x03\xB8\x32"
"\x3D\x56\x70\x76\xC5\xAB\xEF\xC4\x12\x19\x4B\x1A\xE1\xAB\x95\xC1"
;

	char sign_text[]=
"\x4B\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB"
"\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB"
"\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB"
"\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBB\xBA\x97\xBD\x63"
"\x4B\x1A\xEC\xC0\xED\x69\xFB\xE2\xE2\x3D\x09\xD8\x6A\xF7\xC0\x65"
"\x35\x41\x01\x04\x03\x15\xF6\xA5\xCC\xE2\xA3\xBF\xC5\xE3\x01\xC0"
"\xA8\x01\x0C\x33\x70\x42\x29\x5B\x69\x42\x1A\x0C\x36\x29\x1F\x0E"
"\xC0\x56\xF6\x64\x47\x3D\xB8\xD3\x78\x0D\x93\x3A\xC9\x34\x4E\xBC"
;

    
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kd=mirvar(0);
    kn=mirvar(0);


    bytes_to_big(0x80,sign_text,m);
    bytes_to_big(0x80,xoteg_sec,kd);
	bytes_to_big(0x80,xoteg_pub,kn);

    powmod(m,kd,kn,e);

	
	big_to_bytes (0x80, e, result, TRUE);

	show_memory(result,0x80,"data sign:");



	printf("message ends\n");

    return 0;
}





int rsa_decode()
{  

    big e,m,kd,kn;

	char result[0x80];

	char xoteg_pub[]=
"\x72\x30\x3B\x65\xF5\xC4\xEB\x37\x3A\x75\x2F\x95\x85\xB9\x7E\x47"
"\xD5\x0A\x64\x75\xF4\xCB\xAA\x9A\x1A\xC6\xF1\xBA\x0B\xDF\x18\x14"
"\x0D\x4A\xA0\x33\xF9\xA5\x0F\xB0\xD9\x9E\x2C\x57\xAD\xB8\xC5\x44"
"\x6E\x32\x15\x38\xB0\x56\x7B\x97\x5E\x3C\x1B\x17\xE3\xD7\x13\xE2"
"\xF8\x13\x63\x75\x7A\xEC\xFA\x2E\x6C\xEF\x95\x2F\x5C\xAE\x52\x0A"
"\x7C\xF0\x38\x88\x68\x8A\xF2\x4B\x49\x25\xBA\x62\x29\x3E\x2B\xD5"
"\x82\x45\x9A\xE6\x27\x36\xC8\xCC\xC9\xB5\x85\x15\xB9\x18\x95\xC0"
"\x15\xA2\xFF\xA8\x8B\x82\x3F\x2C\x2B\xCF\x6A\xBE\x38\x97\x27\xA7"
;

/*
		
		"\xA7\x27\x97\x38\xBE\x6A\xCF\x2B\x2C\x3F\x82\x8B\xA8\xFF\xA2\x15"
"\xC0\x95\x18\xB9\x15\x85\xB5\xC9\xCC\xC8\x36\x27\xE6\x9A\x45\x82"
"\xD5\x2B\x3E\x29\x62\xBA\x25\x49\x4B\xF2\x8A\x68\x88\x38\xF0\x7C"
"\x0A\x52\xAE\x5C\x2F\x95\xEF\x6C\x2E\xFA\xEC\x7A\x75\x63\x13\xF8"
"\xE2\x13\xD7\xE3\x17\x1B\x3C\x5E\x97\x7B\x56\xB0\x38\x15\x32\x6E"
"\x44\xC5\xB8\xAD\x57\x2C\x9E\xD9\xB0\x0F\xA5\xF9\x33\xA0\x4A\x0D"
"\x14\x18\xDF\x0B\xBA\xF1\xC6\x1A\x9A\xAA\xCB\xF4\x75\x64\x0A\xD5"
"\x47\x7E\xB9\x85\x95\x2F\x75\x3A\x37\xEB\xC4\xF5\x65\x3B\x30\x72"
;
*/


	char xoteg_sec[]=
"\x68\xEF\xC0\x36\x64\x14\xB2\x60\x8F\xBD\x4F\x9C\x66\x46\xE0\x31"
"\x1D\x2C\x2E\xC4\x63\xD1\xA3\x17\x79\xD2\x28\x24\xE4\x72\x02\x0B"
"\xB3\x67\x48\x30\x5B\x94\x80\x05\xF3\x07\x34\x12\xE3\x58\x31\x19"
"\x40\xF7\x8F\x9F\x08\x16\x81\xFF\xCA\x1F\x0C\x7A\xF8\xEC\x17\x9E"
"\x38\x79\x79\x80\x1A\x59\x66\xEB\xC9\xBD\x00\xE9\xE8\xF0\x47\x82"
"\x17\xD9\xF2\x2E\xDE\x56\xDF\x12\x74\x7D\x6E\x95\xA2\x47\x5F\x39"
"\xE5\xB2\x57\xA9\xB7\xC3\xCE\x69\xA0\xB1\x14\xED\xBB\x3A\x58\xB2"
"\x30\xD6\xAA\xBE\x70\xE9\x2F\x39\xE6\x63\x02\x07\xF7\xBF\x88\x69"
;

		/*
"\x69\x88\xBF\xF7\x07\x02\x63\xE6\x39\x2F\xE9\x70\xBE\xAA\xD6\x30"
"\xB2\x58\x3A\xBB\xED\x14\xB1\xA0\x69\xCE\xC3\xB7\xA9\x57\xB2\xE5"
"\x39\x5F\x47\xA2\x95\x6E\x7D\x74\x12\xDF\x56\xDE\x2E\xF2\xD9\x17"
"\x82\x47\xF0\xE8\xE9\x00\xBD\xC9\xEB\x66\x59\x1A\x80\x79\x79\x38"
"\x9E\x17\xEC\xF8\x7A\x0C\x1F\xCA\xFF\x81\x16\x08\x9F\x8F\xF7\x40"
"\x19\x31\x58\xE3\x12\x34\x07\xF3\x05\x80\x94\x5B\x30\x48\x67\xB3"
"\x0B\x02\x72\xE4\x24\x28\xD2\x79\x17\xA3\xD1\x63\xC4\x2E\x2C\x1D"
"\x31\xE0\x46\x66\x9C\x4F\xBD\x8F\x60\xB2\x14\x64\x36\xC0\xEF\x68"
;
*/

	char crypto_text[]=
"\x4B\x7C\x98\xE9\xDB\x3B\x8C\xD5\x26\x36\x2B\x64\xCB\x44\x3F\x03"
"\x06\xE8\x2B\x5C\x39\x52\x69\x1C\x13\xB1\x40\xAB\x3E\x05\x7D\xB4"
"\xFE\x15\x57\x52\xDF\x5F\xEB\x8C\xEB\x56\x40\x1E\x9D\xF9\xE7\x7A"
"\x84\xB7\x7A\xE6\xE4\xF2\x40\x56\x12\xBF\xD7\xFD\xD5\x2D\xAF\xB2"
"\xFF\x9E\x8A\xDA\xE3\xCF\x7E\x29\x68\x93\xF0\x42\x51\x16\x61\x09"
"\xDB\xF5\x4D\x29\x28\xB5\xE4\x02\xE1\x0A\xEE\xEB\x89\xEE\xF1\xFE"
"\x36\xE0\xA4\x41\xAF\x7E\x87\x9F\x6F\x5A\x9A\xB3\x2A\xEF\xBE\xF6"
"\x72\x7A\x99\x67\xD6\xA1\x12\x09\xC1\xC0\x5B\xDC\xFB\x68\x0E\x7E"
;

// ne pravilniy pubkey, ne inversnutiy
/*
"\x9C\xB9\x66\x0D\x10\x37\x19\x52\x44\x63\xA3\x60\xAE\x49\xF2\x8A"
"\x01\x9D\x51\xB6\x73\x89\x31\xDA\x72\x49\x5C\xA1\xFD\xBB\x14\x48"
"\xF1\xA3\x63\x02\xB5\x09\x23\x51\x2C\x66\x6C\xB6\x77\xFC\x5F\x8E"
"\xE5\x95\x04\xB4\x08\x39\x80\x7C\x21\x96\x6B\x7C\xFB\xBD\x35\xE9"
"\x37\xBC\x8D\xB5\x1E\xF0\xEA\xC5\xAD\x98\xC0\x6D\x43\x28\x42\x17"
"\xE3\xA2\xD2\x27\x77\x94\x20\x52\x30\x13\xC7\x7C\x1B\xCB\x11\x56"
"\x7E\x4A\xDC\x1C\xFF\x8D\x13\x0E\xCB\x31\x45\x97\x83\xA4\x0A\x35"
"\x2E\x9E\x9C\x17\xEB\xFA\x92\x2C\xD8\xD6\xF0\xC6\x21\xAC\x3C\x07"
;
*/
    
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kd=mirvar(0);
    kn=mirvar(0);


    bytes_to_big(0x80,crypto_text,m);
	bytes_to_big(0x80,xoteg_sec,kd);
    //bytes_to_big(0x80,calc_d,kd);
	bytes_to_big(0x80,xoteg_pub,kn);

    powmod(m,kd,kn,e);

	
	big_to_bytes (0x80, e, result, TRUE);

	show_memory(result,0x80,"data decode:");



	printf("message ends\n");

    return 0;
}



int rsa_encode()
{
    big e,m,ke;

	char result[0x80];

	char xoteg_pub[]=
"\x72\x30\x3B\x65\xF5\xC4\xEB\x37\x3A\x75\x2F\x95\x85\xB9\x7E\x47"
"\xD5\x0A\x64\x75\xF4\xCB\xAA\x9A\x1A\xC6\xF1\xBA\x0B\xDF\x18\x14"
"\x0D\x4A\xA0\x33\xF9\xA5\x0F\xB0\xD9\x9E\x2C\x57\xAD\xB8\xC5\x44"
"\x6E\x32\x15\x38\xB0\x56\x7B\x97\x5E\x3C\x1B\x17\xE3\xD7\x13\xE2"
"\xF8\x13\x63\x75\x7A\xEC\xFA\x2E\x6C\xEF\x95\x2F\x5C\xAE\x52\x0A"
"\x7C\xF0\x38\x88\x68\x8A\xF2\x4B\x49\x25\xBA\x62\x29\x3E\x2B\xD5"
"\x82\x45\x9A\xE6\x27\x36\xC8\xCC\xC9\xB5\x85\x15\xB9\x18\x95\xC0"
"\x15\xA2\xFF\xA8\x8B\x82\x3F\x2C\x2B\xCF\x6A\xBE\x38\x97\x27\xA7"
;

	/*
"\xA7\x27\x97\x38\xBE\x6A\xCF\x2B\x2C\x3F\x82\x8B\xA8\xFF\xA2\x15"
"\xC0\x95\x18\xB9\x15\x85\xB5\xC9\xCC\xC8\x36\x27\xE6\x9A\x45\x82"
"\xD5\x2B\x3E\x29\x62\xBA\x25\x49\x4B\xF2\x8A\x68\x88\x38\xF0\x7C"
"\x0A\x52\xAE\x5C\x2F\x95\xEF\x6C\x2E\xFA\xEC\x7A\x75\x63\x13\xF8"
"\xE2\x13\xD7\xE3\x17\x1B\x3C\x5E\x97\x7B\x56\xB0\x38\x15\x32\x6E"
"\x44\xC5\xB8\xAD\x57\x2C\x9E\xD9\xB0\x0F\xA5\xF9\x33\xA0\x4A\x0D"
"\x14\x18\xDF\x0B\xBA\xF1\xC6\x1A\x9A\xAA\xCB\xF4\x75\x64\x0A\xD5"
"\x47\x7E\xB9\x85\x95\x2F\x75\x3A\x37\xEB\xC4\xF5\x65\x3B\x30\x72"
;
*/
		


	char clear_text[]=
"\x01\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
"\x29\x49\xCF\x36\x4D\x70\x07\xEA\xD1\x10\x91\xCD\xE3\xE5\x96\x67"
;




    mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    ke=mirvar(0);
 

	bytes_to_big(0x80,xoteg_pub,ke);    
    bytes_to_big(0x80,clear_text,m);

	power(m,65537,ke,e);
	
	big_to_bytes (0x80, e, result, TRUE);

	show_memory(result,0x80,"data:");

    return 0;
}   


//////////////////////


int rsa_calc_pub()
{
    big p,q,public_key;

	char result[0x80];
	char result2[0x80];

	FILE *f;
	int i;



    mip=mirsys(100,0);
    p=mirvar(0);
    q=mirvar(0);
	public_key = mirvar(0); 

	
	//p
	f=fopen("___jjp.txt","r");
	p->len = 16;
	for(i=0;i<16;i++){
		fscanf(f,"%x.", &p->w[i]);
	};
	fclose(f);
	
	//q
	f=fopen("___jjq.txt","r");
	q->len = 16;
	for(i=0;i<16;i++){
		fscanf(f,"%x.", &q->w[i]);
	};
	fclose(f);

	show_memory((char *)p->w,0x40,"p bytes:");
	show_memory((char *)q->w,0x40,"q bytes:");
	


	// public key
	multiply (p, q, public_key);
	

	big_to_bytes (0x80, public_key, result, TRUE);

	// needed to add inverse, i.e last byte first
	for (i=0;i<0x80;i++){
		result2[i]=result[0x80-1-i];
	};


	show_memory(result2,0x80,"data:");


    return 0;
};


// calc d (private key)
int rsa_calc_d()
{
    big p,q,private_key;
	big p1,q1;
	big pq1;
	big g;
	
	unsigned int _w[2] = {0x10001, 0};
	struct bigtype w = {1, _w};

	char result[0x80];

	FILE *f;
	int i;



    mip=mirsys(100,0);
    p=mirvar(0);
    q=mirvar(0);
	private_key = mirvar(0); 

    p1=mirvar(0);
    q1=mirvar(0);
    pq1=mirvar(0);
	g=mirvar(0x10001);

	//p
	f=fopen("___jjp.txt","r");
	p->len = 16;
	for(i=0;i<16;i++){
		fscanf(f,"%x.", &p->w[i]);
	};
	fclose(f);
	
	//q
	f=fopen("___jjq.txt","r");
	q->len = 16;
	for(i=0;i<16;i++){
		fscanf(f,"%x.", &q->w[i]);
	};
	fclose(f);

	show_memory((char *)p->w,0x40,"p bytes:");
	show_memory((char *)q->w,0x40,"q bytes:");
	
	decr(p,1,p1);
	//sftbit(p1,-1,p1);
	decr(q,1,q1);
	//sftbit(q1,-1,q1);
	multiply(p1,q1,pq1);
	
	xgcd(&w,pq1,pq1,pq1,pq1);

	big_to_bytes (0x80, pq1, result, TRUE);


	// needed to add inverse, i.e last byte first
	for (i=0;i<0x80;i++){
		calc_d[i]=result[0x80-1-i];
		//calc_d[i]=result[i];
	};


	//show_memory(calc_d,0x80,"calc_d:");
	show_memory(calc_d,0x80,"calc_d:");


    return 0;
};   

	//g->len=1;
	//g->w[0]=0x10001;
	//show_memory((char *)g->w,0x80,"g:");












char remote_profile[]=
"\x00\x00\x01\x04\x00\x00\x00\x01\x4B\xE3\xAD\x18\x53\x2F\xFB\x8A"
"\xE2\xF1\x3B\x41\x15\x39\x9E\xA6\xB6\x81\x46\x5D\xC1\xC2\xD7\xE9"
"\x0C\x49\xBE\xEF\x0B\x89\x3F\xA3\x35\x8D\xFA\x5C\x46\x5C\x94\x38"
"\x3E\x64\x1A\x85\x9B\xA2\x99\x49\x8A\x22\x9B\xB4\x64\xE7\x58\x50"
"\xA3\xF4\xFD\x6F\x9B\x52\xA2\x3E\x39\x78\x3E\xA1\x31\x5A\x3D\x61"
"\xB4\xA5\xFD\xC0\xBB\x21\x7C\x59\x85\xD9\x9F\x03\x9E\x7E\x0D\x78"
"\xA5\x7E\x29\xAA\x25\xBA\x2E\xF4\xC2\x9A\xEF\x9D\xD4\x6A\x01\x9E"
"\x9B\x1B\x54\x40\x00\x3D\x08\xBA\xE0\xEC\x97\x9F\x70\xB9\x83\x4D"
"\x4F\x86\x2E\xF0\x77\x5B\xB6\xDC\x6F\x84\xD0\x36\xB6\x16\x22\x18"
"\xC2\x29\xEA\x9A\x7A\xCF\x88\xF2\x01\xB9\x08\x82\x44\xF5\x3F\xA6"
"\x35\xB5\x3F\x78\xAE\x29\x8F\x1B\x20\x51\x5C\x2F\x9F\xA5\xA9\xDA"
"\x73\xB7\xB0\xD0\xAC\x7B\x53\x1F\x44\x84\xC8\x9E\xE4\xDE\xCC\x14"
"\xC8\x44\xFE\x3F\x67\x46\x34\xF4\x7A\x17\x84\x30\xAA\x0C\x95\x3C"
"\x39\xC8\xBD\x87\x01\xE5\x6D\xAC\xAF\xEE\xB8\x36\xDF\xAA\x27\xEE"
"\x33\x16\x88\x0E\xDA\x60\xC6\xB3\xD3\x40\x58\xF7\xD2\x6B\xB9\x82"
"\xA7\x79\xA9\x8E\xC0\x1F\x63\xAC\x9C\x29\xB4\xBD\x5D\x7C\x0E\x0F"
"\xA0\xD5\x73\x86\x29\xEF\xBE\x15\x09\x92\x26\xC0\x1E\xF9\x89\x1B"
"\x8F\x98\xA1\x22\x2C\xC6\x88\x39\x38\x62\x4B\x5B\x54\x2E\xA2\x20"
"\x8D\x9B\xC3\x39\xF1\xAE\xB3\x99\x3D\xFE\xE0\x19\xAD\xA6\x0D\xDE"
"\x33\x89\x76\xEB\x7E\x69\x5E\xBD\x67\x0D\x53\xD7\x88\x55\xB4\xB8"
"\xFC\x7D\x98\xF2\x8C\x00\xB8\x46\x3F\x61\x12\x6F\xE7\x99\x34\x25"
"\x22\x50\xDC\x79\xBA\x9E\x8E\x83\xD9\xEE\xDE\xB2\x5D\x17\x1A\xC4"
"\x72\xB3\xC4\x66\xE7\xAB\xBF\xEC\xAC\xCB\x00\x81\x65\x40\x27\x90"
"\xB8\x03\x1C\xBF\xDC\xEC\x9C\xFA\xBB\x3C\xEB\x50\xC4\x3E\xF9\xFB"
"\xC8\x96\x0D\xEE\xE1\x76\x05\x01"
;


/*
"\x00\x00\x01\x04\x00\x00\x00\x01\x8E\xA3\xD6\x8D\x8B\xD5\xDB\x4A"
"\xAA\x42\x6C\x22\x9C\x39\x07\x56\x53\xD3\x7C\xA7\xE1\x72\x89\x66"
"\xC9\xFD\x31\x10\xB9\xA2\x74\x3D\x48\x7B\x22\xC7\x4C\x46\x20\x7F"
"\x07\xE2\xA2\x4D\x79\x24\xAE\x39\x3D\x06\x36\xC5\x92\xBB\xB1\x10"
"\x55\x2B\xB8\x9C\xA9\x14\xD4\xBA\x43\xA6\xAF\x68\xDA\x7E\xFD\x69"
"\xD0\x57\xBC\x16\x0B\x14\xB5\x9D\x26\x5E\x58\x71\xFC\x10\x51\x43"
"\x7B\x41\x6D\x87\xFA\x32\xC6\x93\x5D\x33\x0E\x45\xE2\xD6\xD3\x96"
"\x49\xCC\x58\x72\x7C\x9B\xC5\x3C\x10\x79\xDD\xED\xCB\x49\x2F\x5B"
"\xEA\x11\xA1\xC2\x2E\x82\xBE\x12\x3D\xC6\xBA\x86\xA9\xF3\x92\x5D"
"\x8E\x46\xFC\x80\x21\xC9\xDB\x16\x3A\x2C\xFA\xB7\x66\xAB\x75\x56"
"\xDC\x49\xFC\x28\x9A\x1C\x41\xF2\xF9\xD4\xD7\xA9\x59\xBB\xCA\xFD"
"\x61\xC2\x7D\x1E\xFC\x53\x6D\x7D\xD4\x5B\xE6\xC5\x8E\x6D\xD0\xDE"
"\xCA\x99\x3C\xFC\xDA\x3B\x6F\xCF\x09\x7D\xB2\xC3\xE2\x10\xB0\x58"
"\x53\xA2\x96\x4E\x4D\xDC\x49\x20\xF8\xB2\x47\x55\xF2\x78\xFC\x6E"
"\xA3\x69\xB6\x76\xA5\xCB\x32\xDA\x01\x8B\xE9\x39\x30\xCA\x9C\xFB"
"\x75\x29\x74\xAA\x76\xE7\x53\xEF\xF7\x6C\x8E\x57\xD2\x0E\x2D\x96"
"\x6C\xEA\xA5\xF0\xBA\xE3\x5F\x3B\xA2\x85\x00\x1F\xB2\xAC\xF6\xE4"
"\xA4\xEC\x09\xDC\xEE\xB4\x8A\x8F\x62\x98\x87\xB3\x00\xE0\x7E\x65"
"\x3C\x1A\xD6\x76\x93\xE5\xEC\xC8\x57\xCD\xED\x15\x1A\xF0\x8C\xDC"
"\x5A\x90\x45\x5A\x0F\xB8\xA4\xD7\x19\x1F\xDA\x36\x00\x9D\x9E\x80"
"\x05\x53\x7C\xEB\x0E\x3A\x53\x8A\x31\xB5\xAE\x40\xDC\x9B\x56\x90"
"\x57\xE1\xC5\xC2\xC2\x02\x7B\xA2\x9B\x2C\x7E\x3A\x5F\x3A\xEF\xFC"
"\xC4\x78\xB9\xCC\xF0\xE2\x33\x53\xAC\x78\x68\x18\x61\x21\x03\xEA"
"\x14\x8C\x31\x57\xF0\xAC\x6F\xC7\xB2\xD3\x86\xDA\xE7\x60\x79\x3E"
"\xCC\x50\x50\x2B\xA8\x66\x27\x17"
;
*/

/*
"\x00\x00\x01\x04\x00\x00\x00\x01\x0E\xFE\xA7\x38\xA3\xE9\xA9\xCE"
"\x66\x0D\xDD\x80\x8E\x9C\x1C\x7A\xAA\xAE\x14\x3E\x76\x12\x78\xA8"
"\xA8\x25\x78\xF2\xE7\x86\x5F\x0C\xED\x1C\x5B\xF7\x45\xC1\xC1\x23"
"\xF7\x1C\x7A\x4D\x1A\xA2\x0D\x6C\xBB\xC2\x82\x8A\x9F\xBF\xBB\xD2"
"\xF1\xE5\x8C\xFA\x0B\x6F\x25\xF1\xE9\x8C\x9A\xA0\xF2\x38\xC4\x26"
"\x43\x06\x08\x24\xDB\x0E\x7A\x3E\x62\x91\x30\x30\x25\xE8\xD7\x82"
"\x0E\xB7\x8B\x6A\xB0\x81\x12\x14\xD9\xA2\x16\xAA\xD3\xC7\x0F\xB7"
"\x68\xE3\x19\x0C\x0A\x35\x65\x30\x4D\x42\x57\x32\x1A\x6C\x39\xB9"
"\xD3\x04\xE5\x00\xA5\x99\x46\xA2\x9E\x96\x18\xF4\x32\x64\x5B\x36"
"\x4E\xB2\x1F\x57\x8C\x6A\xCE\x0A\x3C\x5A\xBE\xB7\x53\x02\xDA\xCD"
"\xD9\x12\x33\xA3\xD2\xBB\x83\xF8\x89\x6F\x11\xAE\x13\x37\xA2\xDA"
"\x15\xC5\xC2\xF9\xAD\x7B\xB4\xC1\x97\x69\x12\x97\x5B\xE1\x3F\x76"
"\xD3\xC5\x64\x4D\x27\x06\xC6\x41\x92\x6B\x34\x9D\x72\x05\x73\x5D"
"\xAA\xE4\x1B\x71\x24\x2C\x8B\x67\x8D\x87\xE4\x3E\x10\xB9\x08\x6A"
"\x1A\x72\xD8\x67\x94\xBF\x93\x0F\x10\xC3\x23\xD2\xC3\x55\x3C\x9D"
"\x5A\x36\x61\x56\x8C\xFF\xA3\x5E\x01\xAE\x99\xE2\xD1\x1C\x41\x19"
"\x33\x1C\xC4\x75\x73\x20\xB8\x83\x62\xDC\xC7\xE9\x5B\x3D\x97\x1F"
"\x79\xFB\x23\xBF\xE5\x71\xA2\xE9\x0D\xB5\x33\xB2\x1E\x90\x67\xB5"
"\x6E\xAB\x08\x26\x55\xDB\x27\xD4\xA7\x7E\xC5\xD5\xF4\x6D\x7C\xA4"
"\xE2\x9F\xDE\x63\x94\xEB\xA5\x3D\xFB\x06\x77\x37\x6F\x59\x31\x10"
"\xDD\xF8\x42\x0F\xF6\x8A\xCD\x11\xAF\x71\x34\x25\x53\x82\x71\x77"
"\x30\x98\xD8\x7C\x40\xAF\x66\x8C\x40\xFF\x92\x12\x2A\x70\x63\xE3"
"\xEE\x65\xC7\x92\xB3\xD9\x46\xEB\x63\xDC\x82\x14\xD1\x33\xB5\x86"
"\x26\xC3\x25\x26\x0E\x26\x52\x12\xE9\xA2\xFE\x1A\x4B\x69\x44\xAB"
"\xBD\x0A\x13\xD6\x02\x81\xA1\x64"
;
*/

char gordon_pub[0x81];

int rsa_unsign_profile(char *buf, int len, char *outbuf) {  

    big e,m,kn;
	
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kn=mirvar(0);

    bytes_to_big(0x100,buf,m);
	bytes_to_big(0x100,skype_pub,kn);

	power(m,65537,kn,e);
	
	big_to_bytes (0x100, e, outbuf, TRUE);

    return 0;
}


int rsa_unsign_profile_data(char *buf, int len, char *outbuf) {  

    big e,m,kn;
	
	mip=mirsys(100,0);

    e=mirvar(0);
    m=mirvar(0);
    kn=mirvar(0);

    bytes_to_big(0x80,buf,m);
	bytes_to_big(0x80,gordon_pub,kn);

	power(m,65537,kn,e);
	
	big_to_bytes (0x80, e, outbuf, TRUE);

    return 0;
}



int decode_profile(){
	unsigned char outbuf[0x100];
	int i;

	rsa_unsign_profile(remote_profile+8,0x100,outbuf);
	show_memory(outbuf,0x100,"unsign cred:");


	for(i=0;i<0x100;i++){

		if((outbuf[i]==0x80) && (outbuf[i+1]==0x01)){
			memcpy(gordon_pub,outbuf+i+2,0x80);
		};

	};
	show_memory(gordon_pub,0x80,"pubkey data:");

	rsa_unsign_profile_data(remote_profile+8+0x100,0x80,outbuf);
	show_memory(outbuf,0x80,"unsign data:");

	return 0;
};







int main(int argc, char* argv[])
{


	//rsa_encode();
	//rsa_decode();
	//rsa_sign();
	//rsa_unsign();

	if (0){
		char outbuf[0x100];

		rsa_unsign_cred(remote_credentials,0x100,outbuf);
		show_memory(outbuf,0x100,"unsign cred:");
	};

	
	//decode_profile();


	//rsa_decode();
	
	rsa_unsign();

	//rsa_sign();


	//new

	//rsa_calc_pub();


	// new2

	//printf("calc d\n");
	//rsa_calc_d();


	//printf("encode\n");
    //rsa_encode();

	//printf("decode\n");
	//rsa_decode();

	printf("Hello World!\n");

	return 0;
}



